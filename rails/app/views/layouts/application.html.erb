<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <title><%= content_for(:title) || "PLATEAU-1120 - 千葉市地理空間データビューアー" %></title>
    
    <meta name="description" content="千葉市の地理空間データを活用した次世代デジタルツイン・観光ルート最適化システム">
    <meta name="keywords" content="PLATEAU,地理空間データ,千葉市,3D地図,観光ルート最適化,デジタルツイン">
    <meta name="author" content="PLATEAU-1120 Team">
    
    <meta property="og:title" content="<%= content_for(:title) || 'PLATEAU-1120' %>">
    <meta property="og:description" content="千葉市の地理空間データを活用した次世代デジタルツイン・観光ルート最適化システム">
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= request.url %>">
    <meta property="og:image" content="<%= request.base_url %>/icon.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= content_for(:title) || 'PLATEAU-1120' %>">
    <meta name="twitter:description" content="千葉市の地理空間データを活用した次世代デジタルツイン・観光ルート最適化システム">
    <meta name="twitter:image" content="<%= request.base_url %>/icon.png">
    
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    
    <meta name="cesium-ion-token" content="<%= ENV['CESIUM_ION_ACCESS_TOKEN'] || '' %>">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <% if request.path.include?('cesium') || request.path.include?('chatbot_map') %>
      <link href="https://cesium.com/downloads/cesiumjs/releases/1.134/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <% end %>
    
    <% if request.path.include?('map2d') %>
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <% end %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    
    <%= yield :head %>
  </head>

  <body class="min-h-screen flex flex-col" data-turbo="false">
    <% unless request.path.include?('map2d') || request.path.include?('cesium') || request.path.include?('chatbot_map') %>
      <%= render 'shared/navigation' %>
    <% end %>

    <main class="flex-1">
      <% if notice %>
        <div class="m-0 flex items-center gap-2 bg-green-50 text-green-800 px-4 py-3 border-b border-green-200">
          <i class="fas fa-check-circle"></i>
          <div class="flex-1"><%= notice %></div>
        </div>
      <% end %>
      
      <% if alert %>
        <div class="m-0 flex items-center gap-2 bg-red-50 text-red-800 px-4 py-3 border-b border-red-200">
          <i class="fas fa-exclamation-triangle"></i>
          <div class="flex-1"><%= alert %></div>
        </div>
      <% end %>
      
      <%= yield %>
    </main>
    
    <% if request.path.include?('map2d') %>
      <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <% end %>
    
    <% if request.path.include?('cesium') || request.path.include?('chatbot_map') %>
      <script src="https://cesium.com/downloads/cesiumjs/releases/1.134/Build/Cesium/Cesium.js" 
              onload="console.log('Cesium library loaded successfully')" 
              onerror="console.error('Failed to load Cesium library')"></script>
    <% end %>
    
    <%= javascript_importmap_tags %>
    
    <%= yield :javascript %>
  </body>
</html>
