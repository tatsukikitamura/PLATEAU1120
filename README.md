# PLATEAU Viewer

PLATEAU ãƒ‡ãƒ¼ã‚¿ã¨åœ°ç†ç©ºé–“æƒ…å ±ã‚’ 3D å¯è¦–åŒ–ã™ã‚‹ Rails + CesiumJS ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## æ¦‚è¦

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€å›½åœŸäº¤é€šçœãŒæä¾›ã™ã‚‹ PLATEAUï¼ˆ3D éƒ½å¸‚ãƒ¢ãƒ‡ãƒ«ï¼‰ãƒ‡ãƒ¼ã‚¿ã‚„å„ç¨® GeoJSON ãƒ‡ãƒ¼ã‚¿ã‚’ CesiumJS ä¸Šã§å¯è¦–åŒ–ãƒ»æ“ä½œã™ã‚‹ãŸã‚ã® Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- ğŸŒ CesiumJS ã«ã‚ˆã‚‹ 3D åœ°çƒå„€ã®è¡¨ç¤º
- ğŸ¢ PLATEAU 3D Tiles ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨è¡¨ç¤º
- ğŸ“ GeoJSON ãƒã‚¤ãƒ³ãƒˆãƒ»ãƒ©ã‚¤ãƒ³ãƒ»ãƒãƒªã‚´ãƒ³ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º
- ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- ğŸ—ï¸ OSM Buildings ã®è‡ªå‹•èª­ã¿è¾¼ã¿
- ğŸ¨ ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Backend**: Ruby on Rails 8.0.3
- **Frontend**:
  - CesiumJS 1.134
  - Hotwire (Turbo + Stimulus)
  - Importmap for asset management
- **Database**: SQLite3
- **Web Server**: Puma

## å¿…è¦ãªç’°å¢ƒ

- Ruby 3.x ä»¥ä¸Š
- Node.js (Importmap åˆ©ç”¨ã®ãŸã‚æœ€å°é™ã® npm ã‚³ãƒãƒ³ãƒ‰ç”¨)
- SQLite3

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/tatsukikitamura/PLATEAU1120.git
cd PLATEAU1120
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
bundle install
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.example` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```bash
cp .env.example .env
```

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ Cesium Ion ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šï¼š

```env
CESIUM_ION_ACCESS_TOKEN=your_actual_token_here
```

Cesium Ion ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—æ–¹æ³•ï¼š

1. [Cesium Ion](https://ion.cesium.com/) ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²
2. [Access Tokens](https://ion.cesium.com/tokens) ãƒšãƒ¼ã‚¸ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
3. ç”Ÿæˆã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ `.env` ã«è¨­å®š

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
bin/rails db:create
bin/rails db:migrate
```

### 5. ãƒ‡ãƒ¼ã‚¿ã®é…ç½®

PLATEAU ãƒ‡ãƒ¼ã‚¿ã‚„ GeoJSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `public/data/` é…ä¸‹ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚
è©³ç´°ã¯ [public/data/README.md](public/data/README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```
public/data/
â”œâ”€â”€ geoJSON/
â”‚   â”œâ”€â”€ Point/
â”‚   â”‚   â”œâ”€â”€ landmark.geojson
â”‚   â”‚   â”œâ”€â”€ park.geojson
â”‚   â”‚   â”œâ”€â”€ shelter.geojson
â”‚   â”‚   â””â”€â”€ station.geojson
â”‚   â””â”€â”€ MultiLineString/
â”‚       â”œâ”€â”€ border.geojson
â”‚       â”œâ”€â”€ emergency_route.geojson
â”‚       â””â”€â”€ railway.geojson
â””â”€â”€ tileset/
    â””â”€â”€ bldg/
        â””â”€â”€ bldg_3dtiles_lod1/
            â””â”€â”€ tileset.json
```

### 6. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

```bash
bin/rails server
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

## ä½¿ã„æ–¹

### åŸºæœ¬æ“ä½œ

- **Point**: ãƒã‚¤ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã€å…¬åœ’ã€é¿é›£æ‰€ã€é§…ï¼‰ã‚’è¡¨ç¤º
- **Line**: 3D Tiles ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
- **Multi Line**: ãƒãƒ«ãƒãƒ©ã‚¤ãƒ³ã‚¹ãƒˆãƒªãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ï¼ˆå¢ƒç•Œç·šã€é‰„é“ã€ç·Šæ€¥è¼¸é€é“è·¯ï¼‰ã‚’è¡¨ç¤º

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

ç”»é¢å³ä¸Šã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ãƒãƒ«ã‹ã‚‰ï¼š

1. è¡¨ç¤ºã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠï¼ˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼‰
2. ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ã‚’å…¥åŠ›
3. ã€Œãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚«ãƒ¡ãƒ©æ“ä½œ

- **å·¦ãƒ‰ãƒ©ãƒƒã‚°**: è¦–ç‚¹å›è»¢
- **å³ãƒ‰ãƒ©ãƒƒã‚°**: ãƒ‘ãƒ³ï¼ˆç§»å‹•ï¼‰
- **ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«**: ã‚ºãƒ¼ãƒ ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆ
- **ä¸­ãƒ‰ãƒ©ãƒƒã‚°**: ã‚«ãƒ¡ãƒ©ã®å‚¾ãå¤‰æ›´

## é–‹ç™º

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ stylesheets/      # CSS
â”‚   â”œâ”€â”€ controllers/           # Railsã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©
â”‚   â”œâ”€â”€ javascript/            # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰JavaScript
â”‚   â”‚   â”œâ”€â”€ application.js     # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ 3dtile.js          # 3D Tilesèª­ã¿è¾¼ã¿
â”‚   â”‚   â”œâ”€â”€ geojsonLoader.js   # GeoJSONèª­ã¿è¾¼ã¿
â”‚   â”‚   â”œâ”€â”€ controller.js      # UIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©
â”‚   â”‚   â”œâ”€â”€ geojson.js         # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ schema.js          # ã‚¹ã‚­ãƒ¼ãƒå‡¦ç†
â”‚   â”‚   â””â”€â”€ dataManager.js     # ãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”‚   â””â”€â”€ views/
â”‚       â”œâ”€â”€ layouts/
â”‚       â”‚   â””â”€â”€ application.html.erb
â”‚       â””â”€â”€ main/
â”‚           â””â”€â”€ index.html.erb
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ importmap.rb           # Importmapè¨­å®š
â”‚   â””â”€â”€ routes.rb              # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â””â”€â”€ public/
    â””â”€â”€ data/                  # åœ°ç†ç©ºé–“ãƒ‡ãƒ¼ã‚¿ï¼ˆgitignoreå¯¾è±¡ï¼‰
```

### æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®è¿½åŠ 

1. `app/javascript/geojsonLoader.js` ã® `geourls` é…åˆ—ã« URL ã‚’è¿½åŠ 
2. ã¾ãŸã¯ `app/javascript/3dtile.js` ã® `urls` é…åˆ—ã« 3D Tiles URL ã‚’è¿½åŠ 
3. å¿…è¦ã«å¿œã˜ã¦ `controller.js` ã«ãƒœã‚¿ãƒ³ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ 

### ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

- CSS: `app/assets/stylesheets/application.css`
- 3D Tiles ã‚¹ã‚¿ã‚¤ãƒ«: `app/javascript/3dtile.js` ã® `Cesium3DTileStyle`
- GeoJSON ã‚¹ã‚¿ã‚¤ãƒ«: `app/javascript/geojsonLoader.js` ã® `load` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Cesium ãŒè¡¨ç¤ºã•ã‚Œãªã„

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
2. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«æ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. `public/data/` ã«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã® Network ã‚¿ãƒ–ã§ 404 ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒ `public/data/` é…ä¸‹ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- GeoJSON ã®å½¢å¼ãŒæ­£ã—ã„ã‹ [GeoJSONLint](https://geojsonlint.com/) ã§æ¤œè¨¼

### ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œãªã„

- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ï¼ˆCmd+Shift+R ã¾ãŸã¯ Ctrl+Shift+Rï¼‰
- `bin/rails assets:clobber` ã§ã‚¢ã‚»ãƒƒãƒˆã‚’ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰

## ãƒ‡ãƒ—ãƒ­ã‚¤

### Docker ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```bash
docker build -t plateau-viewer .
docker run -p 3000:3000 -e CESIUM_ION_ACCESS_TOKEN=your_token plateau-viewer
```

### Kamal ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```bash
kamal setup
kamal deploy
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## è²¢çŒ®

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½è¦æœ›ã¯ Issue ã§å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

- [PLATEAU å…¬å¼ã‚µã‚¤ãƒˆ](https://www.mlit.go.jp/plateau/)
- [CesiumJS ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cesium.com/docs/)
- [Rails Guides](https://guides.rubyonrails.org/)
- [Hotwire](https://hotwired.dev/)

## ãŠå•ã„åˆã‚ã›

è³ªå•ã‚„ææ¡ˆã¯ [Issues](https://github.com/tatsukikitamura/PLATEAU1120/issues) ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
