<% content_for :title, "AIチャットbot & 3Dマップ - PLATEAU-1120" %>
<% content_for :head do %>
  <meta name="turbo-visit-control" content="reload">
<% end %>

<div class="flex h-screen overflow-hidden flex-col md:flex-row">
  <!-- 左側: チャットエリア -->
  <div class="flex w-full flex-col border-gray-200 bg-gray-100 md:w-1/2 md:border-r">
    <!-- ヘッダー -->
    <div class="flex items-center justify-between bg-gradient-to-br from-indigo-500 to-purple-600 px-6 py-6 text-white">
      <div>
        <h3 class="m-0 text-base font-semibold">
          <i class="fas fa-robot me-2"></i>
          AIチャットbot
        </h3>
      </div>
      <div>
        <button class="rounded-md bg-white/90 px-3 py-2 text-sm font-medium text-gray-700 shadow hover:bg-white" id="clearChatBtn" title="履歴をクリア">
          <i class="fas fa-trash"></i>
        </button>
        <button class="ml-2 rounded-md bg-white/90 px-3 py-2 text-sm font-medium text-gray-700 shadow hover:bg-white" id="clearMapBtn" title="マップをクリア">
          <i class="fas fa-map"></i>
        </button>
      </div>
    </div>

    <!-- メッセージエリア -->
    <div class="flex-1 overflow-y-auto bg-white p-4" id="chatbot-messages">
      <!-- ウェルカムメッセージ -->
      <div class="mb-6 flex">
        <div class="mr-3 flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-green-600 to-teal-400 text-white text-[1.1rem]">
          <i class="fas fa-robot"></i>
        </div>
        <div class="min-w-0 flex-1">
          <div class="mb-2 flex items-center justify-between text-[0.85rem]">
            <strong class="text-gray-800">AIアシスタント</strong>
            <span class="text-xs text-gray-500">ただいま</span>
          </div>
          <div class="rounded-lg bg-gray-100 px-3 py-2 leading-relaxed text-gray-800">
            こんにちは！千葉市の地理空間データに関する質問にお答えします。<br>
            回答したデータは自動的に右側のマップに表示されます。
          </div>
        </div>
      </div>
    </div>

    <!-- 入力エリア -->
    <div class="border-t border-gray-200 bg-white p-4">
      <form id="chatForm">
        <div class="flex items-end gap-2">
          <textarea
            class="min-h-[40px] w-full resize-y rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"
            id="messageInput"
            rows="2"
            placeholder="メッセージを入力..."
            autocomplete="on"
          ></textarea>
          <button class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-indigo-700" type="submit" id="sendBtn">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 右側: マップエリア -->
  <div class="relative w-full md:w-1/2">
    <div id="cesiumContainer" class="h-full w-full"></div>
  </div>
</div>

<%= content_for :javascript do %>
  
  <script type="module">
    import "chatbot_map_application";
  </script>
<% end %>

